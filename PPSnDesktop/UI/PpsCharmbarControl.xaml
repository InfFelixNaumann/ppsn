<UserControl x:Class="TecWare.PPSn.UI.PpsCharmbarControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
			 xmlns:sys="clr-namespace:System;assembly=mscorlib"
             xmlns:uiL="clr-namespace:TecWare.PPSn.UI"
             mc:Ignorable="d" 
			 x:Name="ppsnCharmbarControl"
             d:DesignHeight="300" d:DesignWidth="300">
	<UserControl.Resources>
        <uiL:PPSnCharmbarContentTypeToCheckedConverter x:Key="contentTypeToCheckedConverter" />

        <Style x:Key="charmbarContentBorderStyle" TargetType="{x:Type Border}">
			<Setter Property="Background" Value="{StaticResource PPSnPopUpBackgroundBrush}"/>
			<Setter Property="BorderThickness" Value="1"/>
			<Setter Property="BorderBrush" Value="{StaticResource PPSnControlFocusedBorderBrush}"/>
			<Setter Property="RenderTransformOrigin">
				<Setter.Value>
					<Point X="1" Y="0.5"/>
				</Setter.Value>
			</Setter>
			<Setter Property="RenderTransform">
				<Setter.Value>
					<ScaleTransform ScaleX="0" ScaleY="1"/>
				</Setter.Value>
			</Setter>
			<Style.Triggers>
				<Trigger Property="Visibility" Value="Visible">
					<Trigger.EnterActions>
						<BeginStoryboard>
							<Storyboard>
								<DoubleAnimation Storyboard.TargetProperty="(RenderTransform).(ScaleTransform.ScaleX)"
												 To="1"
												 BeginTime="0:0:0"
												 Duration="{StaticResource PPSnShrinkStoryDuration}"/>
							</Storyboard>
						</BeginStoryboard>
					</Trigger.EnterActions>
				</Trigger>
			</Style.Triggers>
		</Style>

		<Style x:Key="charmBarToggleButtonStyle" TargetType="{x:Type ToggleButton}">
			<Setter Property="Focusable" Value="False"/>
			<Setter Property="IsThreeState" Value="False"/>
			<Setter Property="Foreground" Value="{StaticResource PPSnActionButtonBrush}"/>
			<Setter Property="Command" Value="{x:Static uiL:PpsCharmbarControl.ChangeContentCommand}"/>
			<Setter Property="CommandParameter" Value="{Binding Tag, RelativeSource={RelativeSource Mode=Self}}" />
			<Setter Property="IsChecked">
				<Setter.Value>
					<MultiBinding Mode="OneWay" Converter="{StaticResource contentTypeToCheckedConverter}" >
						<Binding ElementName="ppsnCharmbarControl" Path="CurrentContentType"/>
						<Binding Path="Tag" RelativeSource="{RelativeSource Mode=Self}"/>
					</MultiBinding>
				</Setter.Value>
			</Setter>
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate TargetType="{x:Type ToggleButton}">
						<Border x:Name="contentBorder" >
							<Grid>
								<Grid.ColumnDefinitions>
									<ColumnDefinition/>
									<ColumnDefinition Width="4"/>
								</Grid.ColumnDefinitions>
								<Border Grid.Row="0" Background="Transparent" Margin="6,3,0,3" Padding="6">
									<Viewbox>
										<Canvas Width="24" Height="24">
											<Path x:Name="imagePath" Data="{TemplateBinding Content}" Fill="{TemplateBinding Foreground}" Opacity=".65">
												<Path.RenderTransformOrigin>
													<Point X="0.5" Y="0.5"/>
												</Path.RenderTransformOrigin>
												<Path.RenderTransform>
													<ScaleTransform x:Name="scaleTransform" ScaleX="1" ScaleY="1"/>
												</Path.RenderTransform>
											</Path>
										</Canvas>
									</Viewbox>
								</Border>
								<Rectangle x:Name="selectedMarker" Grid.Column="1" Fill="{StaticResource PPSnMarkerBrush}" Opacity="0"/>
							</Grid>
						</Border>
						<ControlTemplate.Triggers>
							<Trigger Property="IsChecked" Value="True">
								<Setter TargetName="selectedMarker" Property="Opacity" Value="1"/>
							</Trigger>
							<Trigger Property="IsMouseOver" Value="True">
								<Setter TargetName="imagePath" Property="Opacity" Value="1"/>
							</Trigger>
							<Trigger Property="IsPressed" Value="True">
								<Trigger.EnterActions>
									<BeginStoryboard>
										<Storyboard>
											<DoubleAnimation Storyboard.TargetName="scaleTransform" Storyboard.TargetProperty="ScaleX" From="1" To="0.9" Duration="0:00:0.1"/>
											<DoubleAnimation Storyboard.TargetName="scaleTransform" Storyboard.TargetProperty="ScaleY" From="1" To="0.9" Duration="0:00:0.1"/>
										</Storyboard>
									</BeginStoryboard>
								</Trigger.EnterActions>
								<Trigger.ExitActions>
									<BeginStoryboard>
										<Storyboard>
											<DoubleAnimation Storyboard.TargetName="scaleTransform" Storyboard.TargetProperty="ScaleX" From="0.9" To="1" Duration="0:00:0.05"/>
											<DoubleAnimation Storyboard.TargetName="scaleTransform" Storyboard.TargetProperty="ScaleY" From="0.9" To="1" Duration="0:00:0.05"/>
										</Storyboard>
									</BeginStoryboard>
								</Trigger.ExitActions>
							</Trigger>
						</ControlTemplate.Triggers>
					</ControlTemplate>
				</Setter.Value>
			</Setter>
		</Style>

		<ControlTemplate x:Key="charmbarContentHeaderTemplate" TargetType="{x:Type ContentControl}">
			<Grid>
				<Grid.ColumnDefinitions>
					<ColumnDefinition/>
					<ColumnDefinition Width="40"/>
				</Grid.ColumnDefinitions>
				<Grid.RowDefinitions>
					<RowDefinition Height="40"/>
					<RowDefinition Height="16"/>
				</Grid.RowDefinitions>
				<TextBlock Grid.Column="0" Grid.Row="0" Margin="16,0,0,0"
						   Text="{TemplateBinding Content}"
						   Foreground="{StaticResource PPSnWindowForegroundBrush}"
						   VerticalAlignment="Center"
						   FontSize="18"/>
				<Button Grid.Column="1" Grid.Row="0" 
						Command="{x:Static uiL:PpsCharmbarControl.ChangeContentCommand}"
						Content="{StaticResource windowClosePathGeometry}"
						Foreground="{StaticResource PPSnWindowForegroundBrush}"
						Style="{StaticResource PPSnImageButtonStyle}">
					<Button.CommandParameter>
						<uiL:PPSnCharmbarContentType>Default</uiL:PPSnCharmbarContentType>
					</Button.CommandParameter>
				</Button>
			</Grid>
		</ControlTemplate>

		<!--no content to view-->
		<DataTemplate x:Key="emptyTemplate"/>

		<DataTemplate x:Key="noteTemplate">
			<Border Style="{StaticResource charmbarContentBorderStyle}">
				<Grid>
					<Grid.RowDefinitions>
						<RowDefinition Height="auto"/>
						<RowDefinition/>
					</Grid.RowDefinitions>
                    <ContentControl Grid.Row="0" Content="Notizen" Template="{StaticResource charmbarContentHeaderTemplate}"/>
                    <uiL:PpsNotesEditor DataContext="{Binding}" Grid.Row="1" />
                </Grid>
			</Border>
		</DataTemplate>

		<DataTemplate x:Key="linkTemplate">
			<Border Style="{StaticResource charmbarContentBorderStyle}">
				<Grid>
					<Grid.RowDefinitions>
						<RowDefinition Height="auto"/>
						<RowDefinition/>
					</Grid.RowDefinitions>
					<ContentControl Grid.Row="0" Content="Verknüpfungen" Template="{StaticResource charmbarContentHeaderTemplate}"/>
                    <ListBox Grid.Row="1" ItemsSource="{Binding Links}">
                        <ListBox.ItemTemplate>
                            <ItemContainerTemplate>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="75"/>
                                        <ColumnDefinition Width="75"/>
                                    </Grid.ColumnDefinitions>
                                    <Label Grid.Column="0" Content="{Binding LinkToId}"/>
                                    <Label Grid.Column="1" Content="{Binding LinkTo}"/>
                                </Grid>
                            </ItemContainerTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </Grid>
            </Border>
		</DataTemplate>

		<DataTemplate x:Key="revisionTemplate">
			<Border Style="{StaticResource charmbarContentBorderStyle}">
				<Grid>
					<Grid.RowDefinitions>
						<RowDefinition Height="auto"/>
						<RowDefinition/>
					</Grid.RowDefinitions>
					<ContentControl Grid.Row="0" Content="Revisionierung" Template="{StaticResource charmbarContentHeaderTemplate}"/>
				</Grid>
			</Border>
		</DataTemplate>

		<DataTemplate x:Key="qmTemplate">
			<Border Style="{StaticResource charmbarContentBorderStyle}">
				<Grid>
					<Grid.RowDefinitions>
						<RowDefinition Height="auto"/>
						<RowDefinition/>
					</Grid.RowDefinitions>
					<ContentControl Grid.Row="0" Content="QM" Template="{StaticResource charmbarContentHeaderTemplate}"/>
				</Grid>
			</Border>
		</DataTemplate>

		<DataTemplate x:Key="tagTemplate">
			<Border Style="{StaticResource charmbarContentBorderStyle}">
				<Grid>
					<Grid.RowDefinitions>
						<RowDefinition Height="auto"/>
                        <RowDefinition/>
                    </Grid.RowDefinitions>
					<ContentControl Grid.Row="0" Content="Tags" Template="{StaticResource charmbarContentHeaderTemplate}"/>
                    <uiL:PpsTagsEditor DataContext="{Binding}" />
                </Grid>
            </Border>
		</DataTemplate>

		<DataTemplate x:Key="taskTemplate">
			<Border Style="{StaticResource charmbarContentBorderStyle}">
				<Grid>
					<Grid.RowDefinitions>
						<RowDefinition Height="auto"/>
						<RowDefinition/>
					</Grid.RowDefinitions>
					<ContentControl Grid.Row="0" Content="Termine / Aufgaben" Template="{StaticResource charmbarContentHeaderTemplate}"/>
				</Grid>
			</Border>
		</DataTemplate>

		<Style x:Key="charmBarContentStyle" TargetType="ContentPresenter">
			<Setter Property="ContentTemplate" Value="{StaticResource emptyTemplate}"/>
			<Style.Triggers>
				<DataTrigger Binding="{Binding CurrentContentType, ElementName=ppsnCharmbarControl, Mode=OneWay}">
					<DataTrigger.Value>
						<uiL:PPSnCharmbarContentType>Note</uiL:PPSnCharmbarContentType>
					</DataTrigger.Value>
					<Setter Property="ContentTemplate" Value="{StaticResource noteTemplate}"/>
				</DataTrigger>
				<DataTrigger Binding="{Binding CurrentContentType, ElementName=ppsnCharmbarControl, Mode=OneWay}">
					<DataTrigger.Value>
						<uiL:PPSnCharmbarContentType>Link</uiL:PPSnCharmbarContentType>
					</DataTrigger.Value>
					<Setter Property="ContentTemplate" Value="{StaticResource linkTemplate}"/>
				</DataTrigger>
				<DataTrigger Binding="{Binding CurrentContentType, ElementName=ppsnCharmbarControl, Mode=OneWay}">
					<DataTrigger.Value>
						<uiL:PPSnCharmbarContentType>Revision</uiL:PPSnCharmbarContentType>
					</DataTrigger.Value>
					<Setter Property="ContentTemplate" Value="{StaticResource revisionTemplate}"/>
				</DataTrigger>
				<DataTrigger Binding="{Binding CurrentContentType, ElementName=ppsnCharmbarControl, Mode=OneWay}">
					<DataTrigger.Value>
						<uiL:PPSnCharmbarContentType>Qm</uiL:PPSnCharmbarContentType>
					</DataTrigger.Value>
					<Setter Property="ContentTemplate" Value="{StaticResource qmTemplate}"/>
				</DataTrigger>
				<DataTrigger Binding="{Binding CurrentContentType, ElementName=ppsnCharmbarControl, Mode=OneWay}">
					<DataTrigger.Value>
						<uiL:PPSnCharmbarContentType>Tag</uiL:PPSnCharmbarContentType>
					</DataTrigger.Value>
					<Setter Property="ContentTemplate" Value="{StaticResource tagTemplate}"/>
				</DataTrigger>
				<DataTrigger Binding="{Binding CurrentContentType, ElementName=ppsnCharmbarControl, Mode=OneWay}">
					<DataTrigger.Value>
						<uiL:PPSnCharmbarContentType>Task</uiL:PPSnCharmbarContentType>
					</DataTrigger.Value>
					<Setter Property="ContentTemplate" Value="{StaticResource taskTemplate}"/>
				</DataTrigger>
			</Style.Triggers>
		</Style>
	</UserControl.Resources>

	<!--Background must be null!-->
	<Grid>
		<Grid.Style>
			<Style TargetType="{x:Type Grid}">
				<Setter Property="Margin" Value="0,0,0,0"/>
				<Style.Triggers>
					<DataTrigger Binding="{Binding CurrentPane.HasSideBar, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=uiL:PpsMainWindow, AncestorLevel=1}, Mode=OneWay}">
						<DataTrigger.Value>
							<sys:Boolean>True</sys:Boolean>
						</DataTrigger.Value>
						<Setter Property="Margin">
							<Setter.Value>
								<Thickness Left="{StaticResource PPSnSideBarIncreasedWidth}" Top="0" Right="0" Bottom="0"/>
							</Setter.Value>
						</Setter>
					</DataTrigger>
					<DataTrigger Binding="{Binding CurrentContentType, ElementName=ppsnCharmbarControl, Mode=OneWay}">
						<DataTrigger.Value>
							<uiL:PPSnCharmbarContentType>Default</uiL:PPSnCharmbarContentType>
						</DataTrigger.Value>
						<Setter Property="Width" Value="{StaticResource PPSnCharmBarColumnWidth}"/>
						<Setter Property="HorizontalAlignment" Value="Right"/>
					</DataTrigger>
				</Style.Triggers>
			</Style>
		</Grid.Style>
		<Grid.ColumnDefinitions>
			<ColumnDefinition Width="*"/>
			<!--Bindings do use type converters though-->
			<ColumnDefinition Width="{Binding Source={StaticResource PPSnCharmBarColumnWidth}, Mode=OneTime}"/>
		</Grid.ColumnDefinitions>

		<Border Grid.Column="0" MaxWidth="{StaticResource PPSnPaneMaxGridWidth}">
			<Border.Margin>
				<Thickness Left="{StaticResource PPSnPaneBorderSizeLeft}"
						   Top="0"
						   Right="{StaticResource PPSnPaneBorderSizeRight}"
						   Bottom="0"/>
			</Border.Margin>
			<Border.Style>
				<Style TargetType="{x:Type Border}">
					<Style.Triggers>
						<DataTrigger Binding="{Binding CurrentContentType, ElementName=ppsnCharmbarControl, Mode=OneWay}">
							<DataTrigger.Value>
								<uiL:PPSnCharmbarContentType>Default</uiL:PPSnCharmbarContentType>
							</DataTrigger.Value>
							<Setter Property="Visibility" Value="Collapsed"/>
						</DataTrigger>
					</Style.Triggers>
				</Style>
			</Border.Style>
			<ContentPresenter Content="{Binding}" Style="{StaticResource charmBarContentStyle}"/>
		</Border>

		<DockPanel Grid.Column="1" LastChildFill="False" VerticalAlignment="Bottom">
			<DockPanel.Resources>
				<Style TargetType="{x:Type ToggleButton}" BasedOn="{StaticResource charmBarToggleButtonStyle}">
					<Setter Property="Height" Value="48"/>
					<Setter Property="DockPanel.Dock" Value="Top"/>
				</Style>
			</DockPanel.Resources>
			<ToggleButton Content="{StaticResource noteOutlinePathGeometry}">
				<ToggleButton.Tag>
					<uiL:PPSnCharmbarContentType>Note</uiL:PPSnCharmbarContentType>
				</ToggleButton.Tag>
			</ToggleButton>
			<ToggleButton Content="{StaticResource linkPathGeometry}">
				<ToggleButton.Tag>
					<uiL:PPSnCharmbarContentType>Link</uiL:PPSnCharmbarContentType>
				</ToggleButton.Tag>
			</ToggleButton>
			<ToggleButton Content="{StaticResource revisionOutlinePathGeometry}">
				<ToggleButton.Tag>
					<uiL:PPSnCharmbarContentType>Revision</uiL:PPSnCharmbarContentType>
				</ToggleButton.Tag>
			</ToggleButton>
			<ToggleButton Content="{StaticResource qmClockPathGeometry}">
				<ToggleButton.Tag>
					<uiL:PPSnCharmbarContentType>Qm</uiL:PPSnCharmbarContentType>
				</ToggleButton.Tag>
			</ToggleButton>
			<ToggleButton Content="{StaticResource mapMarkerOutlinePathGeometry}">
				<ToggleButton.Tag>
					<uiL:PPSnCharmbarContentType>Tag</uiL:PPSnCharmbarContentType>
				</ToggleButton.Tag>
			</ToggleButton>
			<ToggleButton Content="{StaticResource calendarClockPathGeometry}">
				<ToggleButton.Tag>
					<uiL:PPSnCharmbarContentType>Task</uiL:PPSnCharmbarContentType>
				</ToggleButton.Tag>
			</ToggleButton>
		</DockPanel>
	</Grid>
</UserControl>