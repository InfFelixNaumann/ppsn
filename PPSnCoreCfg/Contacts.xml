<?xml version="1.0" encoding="utf-8" ?>
<fragment xmlns="http://tecware-gmbh.de/dev/des/2014"
		xmlns:pps="http://tecware-gmbh.de/dev/des/2015/ppsn">
	<luaengine>
		<script id="ContactsScript" filename="contacts\contactsServer.lua" />
	</luaengine>

	<pps:ppsn name="ppsn">
		<pps:register source="main">
			<!-- contact fields -->
			<pps:field name="dbo.Kont.ObjkId" />
			<pps:field name="dbo.Kont.Name">
				<pps:attribute name="displayName">Name</pps:attribute>
			</pps:field>
			<pps:field name="dbo.Kont.LiefNr" />
			<pps:field name="dbo.Kont.KundNr" />
			<pps:field name="dbo.Kont.Iban" />
			<pps:field name="dbo.Kont.Bic" />
			<pps:field name="dbo.Kont.Abc" />
			<pps:field name="dbo.Kont.SteuerNr" />
			<pps:field name="dbo.Kont.StIdentNr" />
			<pps:field name="dbo.Kont.UstIdNr" />
			<pps:field name="dbo.Kont.Inaktiv" />
			<pps:field name="dbo.Kont.KgrpId" />
			<pps:field name="dbo.Kont.KurzName" >
				<pps:attribute name="displayName">Kurzname</pps:attribute>
			</pps:field>
			
			<pps:field name="dbo.Kont.LandId" dataType="int">
				<pps:attribute name="displayName">Land</pps:attribute>
			</pps:field>
			<pps:field name="dbo.Kont.FibuNr" dataType="string">
				<pps:attribute name="maxLength">20</pps:attribute>
				<pps:attribute name="displayName">Fibu-Nr</pps:attribute>
			</pps:field>
			<pps:field name="dbo.Kont.Anmerk" dataType="string">
				<pps:attribute name="maxLength">2048</pps:attribute>
				<pps:attribute name="displayName">Anmerkung</pps:attribute>
			</pps:field>

			<pps:field name="dbo.Ansp.Id" />
			<pps:field name="dbo.Ansp.AdreId" />
			<pps:field name="dbo.Ansp.Name" />
			<pps:field name="dbo.Ansp.Titel" />
			<pps:field name="dbo.Ansp.Tel" />
			<pps:field name="dbo.Ansp.Fax" />
			<pps:field name="dbo.Ansp.Mail" />
			<pps:field name="dbo.Ansp.Mobil" />
			<pps:field name="dbo.Ansp.Std" />
			<pps:field name="dbo.Ansp.Geschl" />
			<pps:field name="dbo.Ansp.Funktion" />
			<pps:field name="dbo.Ansp.Brief" />
			<pps:field name="dbo.Ansp.Anmerk" />
			
			<!-- menü eintrag für online daten praktisch?
			<pps:view name="contacts" displayName="Kontakte">
				<pps:source type="select">
					<![CDATA[
						select 
								o.Id
								,o.[Guid]
								,o.Typ
								,o.Nr
								,o.HeadRevId
								,k.Name
							from dbo.Objk o
								inner join sds.Kont k on (o.Id = k.ObjkId)
							where Typ = 'crmContacts']]>
				</pps:source>
			</pps:view> -->

			<!-- contacts mask -->
			<pps:dataset name="contactsDataSet" inherited="coreDataSet" clientScripts="contacts\contactsLocal.lua" serverScripts="ContactsScript">
				<pps:autoTag name="Name" tableName="Head" columnName="Name" mode="First" />
				<pps:autoTag name="LiefNr" tableName="Head" columnName="LiefNr" mode="Number" />
				<pps:autoTag name="KundNr" tableName="Head" columnName="KundNr" mode="Number" />
				<pps:autoTag name="Inaktiv" tableName="Head" columnName="Inaktiv" mode="First" />

				<pps:table name="Head">
					<pps:column name="ObjkId" fieldName="dbo.Kont.ObjkId" />
					<pps:column name="Name" fieldName="dbo.Kont.Name" />
					<pps:column name="LiefNr" fieldName="dbo.Kont.LiefNr" />
					<pps:column name="KundNr" fieldName="dbo.Kont.KundNr" />
					<pps:column name="KurzName" fieldName="dbo.Kont.KurzName" />
					<pps:column name="UstIdNr" fieldName="dbo.Kont.UstIdNr" />
					<pps:column name="Iban" fieldName="dbo.Kont.Iban" />
					<pps:column name="Bic" fieldName="dbo.Kont.Bic" />
					<pps:column name="Abc" fieldName="dbo.Kont.Abc" />
					<pps:column name="LandId" fieldName="dbo.Kont.LandId" />
					<pps:column name="KgrpId" fieldName="dbo.Kont.KgrpId" />
					<pps:column name="StIdentNr" fieldName="dbo.Kont.StIdentNr" />
					<pps:column name="SteuerNr" fieldName="dbo.Kont.SteuerNr" />
					<pps:column name="FibuNr" fieldName="dbo.Kont.FibuNr" />
					<pps:column name="Anmerk" fieldName="dbo.Kont.Anmerk" />
					<pps:column name="Inaktiv" fieldName="dbo.Kont.Inaktiv" />
				</pps:table>

				<pps:table name="Adre">
					<pps:column name="Id" fieldName="dbo.Adre.Id" isPrimary="true" />
					<pps:relation name="ObjkId" fieldName="dbo.Adre.ObjkId" relationName="AdreHead" parentTable="Head" parentColumn="Id" parentType="Root" />
					<pps:column name="Name" fieldName="dbo.Adre.Name" />
					<pps:column name="Postfach" fieldName="dbo.Adre.Postfach" />
					<pps:column name="Zusatz" fieldName="dbo.Adre.Zusatz" />
					<pps:column name="Strasse" fieldName="dbo.Adre.Strasse" />
					<pps:column name="Ort" fieldName="dbo.Adre.Ort" />
					<pps:column name="Region" fieldName="dbo.Adre.Region" />
					<pps:column name="Plz" fieldName="dbo.Adre.Plz" />
					<pps:column name="LandId" fieldName="dbo.Adre.LandId" />
				</pps:table>

				<pps:table name="Ansp">
					<pps:column name="Id" fieldName="dbo.Ansp.Id" isPrimary="true" />
					<pps:relation name="AdreId" fieldName="dbo.Ansp.AdreId" relationName="AnspAdre" parentTable="Adre" parentColumn="Id" parentType="Root" />
					<pps:column name="Name" fieldName="dbo.Ansp.Name" />
					<pps:column name="Titel" fieldName="dbo.Ansp.Titel" />
					<pps:column name="Tel" fieldName="dbo.Ansp.Tel" />
					<pps:column name="Fax" fieldName="dbo.Ansp.Fax" />
					<pps:column name="Mail" fieldName="dbo.Ansp.Mail" />
					<pps:column name="Mobil" fieldName="dbo.Ansp.Mobil" />
					<pps:column name="Std" fieldName="dbo.Ansp.Std" />
					<pps:column name="Geschl" fieldName="dbo.Ansp.Geschl" />
					<pps:column name="Funktion" fieldName="dbo.Ansp.Funktion" />
					<pps:column name="Brief" fieldName="dbo.Ansp.Brief" />
					<pps:column name="Anmerk" fieldName="dbo.Ansp.Anmerk" />
				</pps:table>
			</pps:dataset>
		</pps:register>

		<pps:wpf name="wpf">
			<pps:template id="contacts" file="ClientWpf\Templates\Contacts.xaml" />
			
			<pps:view name="crmContacts" displayName="Kontakt" displayGlyph="usersImage" view="local.objects" filter="Typ:=crmContacts">
				<pps:filter name="lief" displayName="Lieferanten">
					<![CDATA[ LiefNr:! ]]>
				</pps:filter>
				<pps:filter name="kund" displayName="Kunden">
					<![CDATA[ KundNr:! ]]>
				</pps:filter>
				<pps:filter name="rest" displayName="Sonstige">
					<![CDATA[ LiefNr: KundNr: ]]>
				</pps:filter>
				<pps:order name="Name" displayName="Nummer">
					<![CDATA[ +Name,+Nr ]]>
				</pps:order>
				<pps:order name="nr" displayName="LiefNummer">
					<![CDATA[ +LIEFNR ]]>
				</pps:order>
				<pps:order name="test" displayName="Test">
					<![CDATA[ +Name ]]>
				</pps:order>
				<pps:order name="inaktiv" displayName="Inaktivierungsdatum">
					<![CDATA[ +Inaktiv ]]>
				</pps:order>
			</pps:view>
			
			<pps:action name="contactNew" displayName="Neue Kontakt" priority="100">
				<pps:condition><![CDATA[ return CurrentView == Views.crmContacts; ]]></pps:condition>
				<pps:code><![CDATA[ Window:LoadMask{ document = 'crmContacts', pane = 'wpf/panes/contacts.xaml' }; ]]></pps:code>
			</pps:action>
			<pps:action name="contactOpen" displayName="Bearbeiten" priority="200">
				<pps:condition><![CDATA[ return CurrentItem ~= nil and CurrentItem.Typ == "crmContacts" ]]></pps:condition>
				<pps:code><![CDATA[ Window:LoadMask{ document = 'crmContacts', pane = 'wpf/panes/contacts.xaml', guid = CurrentItem.Guid }; ]]> </pps:code>
			</pps:action>
		</pps:wpf>

		<pps:document name="crmContacts" dataset="contactsDataSet" displayname="Contacts">
		</pps:document>
	</pps:ppsn>
</fragment>