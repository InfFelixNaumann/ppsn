<?xml version="1.0" encoding="utf-8" ?>
<fragment xmlns="http://tecware-gmbh.de/dev/des/2014"
		xmlns:pps="http://tecware-gmbh.de/dev/des/2015/ppsn">
	<luaengine>
		<script id="ContractScript" filename="contract\contractServer.lua" />
	</luaengine>

	<pps:ppsn name="ppsn">
		<pps:register source="main">
			<!-- contract fields -->
			<pps:field name="dbo.Auko.ObjkId" >
				<pps:attribute name="dataType">long</pps:attribute>
			</pps:field>
			<pps:field name="dbo.Auko.Datum" >
				<pps:attribute name="dataType">datetime</pps:attribute>
				<pps:attribute name="displayName">Datum</pps:attribute>
			</pps:field>
			<pps:field name="dbo.Auko.BestDatum" >
				<pps:attribute name="dataType">datetime</pps:attribute>
				<pps:attribute name="displayName">Bestelldatum</pps:attribute>
			</pps:field>
			<pps:field name="dbo.Auko.KontId" >
				<pps:attribute name="dataType">long</pps:attribute>
				<pps:attribute name="displayName">Kontakt</pps:attribute>
			</pps:field>
			<pps:field name="dbo.Auko.Adresse" >
				<pps:attribute name="dataType">string</pps:attribute>
				<pps:attribute name="maxLength">1024</pps:attribute>
				<pps:attribute name="displayName">Adresse</pps:attribute>
			</pps:field>
			<pps:field name="dbo.Auko.VeAdre" >
				<pps:attribute name="dataType">string</pps:attribute>
				<pps:attribute name="maxLength">1024</pps:attribute>
				<pps:attribute name="displayName">Versandadresse</pps:attribute>
			</pps:field>
			<pps:field name="dbo.Auko.ReAdre" >
				<pps:attribute name="dataType">string</pps:attribute>
				<pps:attribute name="maxLength">1024</pps:attribute>
				<pps:attribute name="displayName">Rechnungsadresse</pps:attribute>
			</pps:field>
			<pps:field name="dbo.Auko.BestNr" >
				<pps:attribute name="dataType">string</pps:attribute>
				<pps:attribute name="maxLength">20</pps:attribute>
				<pps:attribute name="displayName">Bestellnr.</pps:attribute>
			</pps:field>
			<pps:field name="dbo.Auko.Zusatz" >
				<pps:attribute name="dataType">string</pps:attribute>
				<pps:attribute name="maxLength">128</pps:attribute>
				<pps:attribute name="displayName">Bestellangaben</pps:attribute>
			</pps:field>
			<pps:field name="dbo.Auko.PersId" >
				<pps:attribute name="dataType">long</pps:attribute>
				<pps:attribute name="displayName">Sachbearbeiter</pps:attribute>
			</pps:field>
			<pps:field name="dbo.Auko.Ansp" >
				<pps:attribute name="dataType">long</pps:attribute>
				<pps:attribute name="displayName">Ansprechpartner</pps:attribute>
			</pps:field>
			<pps:field name="dbo.Auko.KopfText" >
				<pps:attribute name="dataType">string</pps:attribute>
				<pps:attribute name="maxLength">2048</pps:attribute>
				<pps:attribute name="displayName">Kopftext</pps:attribute>
			</pps:field>
			<pps:field name="dbo.Auko.FussText" >
				<pps:attribute name="dataType">string</pps:attribute>
				<pps:attribute name="maxLength">2048</pps:attribute>
				<pps:attribute name="displayName">Fusstext</pps:attribute>
			</pps:field>
			<pps:field name="dbo.Auko.Anmerk" >
				<pps:attribute name="dataType">string</pps:attribute>
				<pps:attribute name="maxLength">2048</pps:attribute>
				<pps:attribute name="displayName">Anmerkungen</pps:attribute>
			</pps:field>

			<pps:field name="dbo.Aupo.Id" >
				<pps:attribute name="dataType">long</pps:attribute>
			</pps:field>
			<pps:field name="dbo.Aupo.ObjkId" >
				<pps:attribute name="dataType">long</pps:attribute>
			</pps:field>
			<pps:field name="dbo.Aupo.Pos" >
				<pps:attribute name="dataType">int</pps:attribute>
				<pps:attribute name="displayName">Position</pps:attribute>
			</pps:field>
			<pps:field name="dbo.Aupo.ProdId" >
				<pps:attribute name="dataType">long</pps:attribute>
				<pps:attribute name="displayName">Produkt</pps:attribute>
			</pps:field>
			<pps:field name="dbo.Aupo.ProdNr" >
				<pps:attribute name="dataType">string</pps:attribute>
				<pps:attribute name="maxLength">20</pps:attribute>
				<pps:attribute name="displayName">Produkt-Nr.</pps:attribute>
			</pps:field>
			<pps:field name="dbo.Aupo.Znr" >
				<pps:attribute name="dataType">string</pps:attribute>
				<pps:attribute name="maxLength">30</pps:attribute>
				<pps:attribute name="displayName">Zeich-Nr.</pps:attribute>
			</pps:field>
			<pps:field name="dbo.Aupo.Text" >
				<pps:attribute name="dataType">string</pps:attribute>
				<pps:attribute name="maxLength">2048</pps:attribute>
				<pps:attribute name="displayName">Produkttext</pps:attribute>
			</pps:field>
			<pps:field name="dbo.Aupo.KontProdNr" >
				<pps:attribute name="dataType">string</pps:attribute>
				<pps:attribute name="maxLength">20</pps:attribute>
				<pps:attribute name="displayName">Kunden-Produkt-Nr.</pps:attribute>
			</pps:field>
			<pps:field name="dbo.Aupo.Termin" >
				<pps:attribute name="dataType">datetime</pps:attribute>
				<pps:attribute name="displayName">Termin</pps:attribute>
			</pps:field>
			<pps:field name="dbo.Aupo.Menge" >
				<pps:attribute name="dataType">decimal</pps:attribute>
				<pps:attribute name="displayName">Menge</pps:attribute>
			</pps:field>
			
			<!-- contracts mask -->
			<pps:dataset name="contractDataSet" inherited="coreDataSet" serverScripts="ContractScript">
				<pps:autoTag name="Nr" tableName="Head" columnName="Nr" mode="First" />

				<pps:table name="Head">
					<pps:column name="ObjkId" fieldName="dbo.Auko.ObjkId" />
					<pps:column name="Datum" fieldName="dbo.Auko.Datum" />
					<pps:column name="BestDatum" fieldName="dbo.Auko.BestDatum" />
					<pps:column name="BestNr" fieldName="dbo.Auko.BestNr" />
					<pps:column name="KontId" fieldName="dbo.Auko.KontId" />
					<pps:column name="Adresse" fieldName="dbo.Auko.Adresse" />
					<pps:column name="VeAdre" fieldName="dbo.Auko.VeAdre" />
					<pps:column name="ReAdre" fieldName="dbo.Auko.ReAdre" />
					<pps:column name="Zusatz" fieldName="dbo.Auko.Zusatz" />
					<pps:column name="PersId" fieldName="dbo.Auko.PersId" />
					<pps:column name="Ansp" fieldName="dbo.Auko.Ansp" />
					<pps:column name="KopfText" fieldName="dbo.Auko.KopfText" />
					<pps:column name="FussText" fieldName="dbo.Auko.FussText" />
					<pps:column name="Anmerk" fieldName="dbo.Auko.Anmerk" />
				</pps:table>

				<pps:table name="Aupo">
					<pps:column name="Id" fieldName="dbo.Aupo.Id" isPrimary="true" />
					<pps:relation name="ObjkId" fieldName="dbo.Aupo.ObjkId" relationName="AupoHead" parentTable="Head" parentColumn="Id" parentType="Root" />
					<pps:column name="Pos" fieldName="dbo.Aupo.Pos" />
					<pps:column name="ProdId" fieldName="dbo.Aupo.ProdId" />
					<pps:column name="ProdNr" fieldName="dbo.Aupo.ProdNr" />
					<pps:column name="Znr" fieldName="dbo.Aupo.Znr" />
					<pps:column name="Text" fieldName="dbo.Aupo.Text" />
					<pps:column name="KontProdNr" fieldName="dbo.Aupo.KontProdNr" />
					<pps:column name="Termin" fieldName="dbo.Aupo.Termin" />
					<pps:column name="Menge" fieldName="dbo.Aupo.Menge" />
				</pps:table>

			</pps:dataset>
		</pps:register>

		<pps:wpf name="wpf">
			<pps:template id="contract" file="ClientWpf\Templates\Contract.xaml" />

			<pps:view name="sdsContract" displayName="Aufträge" displayGlyph="usersImage" view="local.objects" filter="Typ:=sdsContract">
				<pps:order name="Name" displayName="Nummer">
					<![CDATA[ +Nr ]]>
				</pps:order>
			</pps:view>

			<pps:action name="contractNew" displayName="Neuer Auftrag" priority="100">
				<pps:condition><![CDATA[ return CurrentView == Views.sdsContract; ]]></pps:condition>
				<pps:code><![CDATA[ Window:LoadMask{ document = 'sdsContract', pane = 'wpf/panes/contract.xaml' }; ]]></pps:code>
			</pps:action>
			<pps:action name="contractOpen" displayName="Bearbeiten" priority="200">
				<pps:condition><![CDATA[ return CurrentItem ~= nil and CurrentItem.Typ == "sdsContract" ]]></pps:condition>
				<pps:code><![CDATA[ Window:LoadMask{ document = 'sdsContract', pane = 'wpf/panes/contract.xaml', guid = CurrentItem.Guid }; ]]> </pps:code>
			</pps:action>
		</pps:wpf>

		<pps:document name="sdsContract" dataset="contractDataSet" displayname="Contract">
		</pps:document>
	</pps:ppsn>
</fragment>