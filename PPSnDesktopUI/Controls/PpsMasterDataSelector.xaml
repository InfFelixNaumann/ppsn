<!--
Licensed under the EUPL, Version 1.1 or - as soon they will be approved by the
European Commission - subsequent versions of the EUPL(the "Licence"); You may
not use this work except in compliance with the Licence.

You may obtain a copy of the Licence at:
http://ec.europa.eu/idabc/eupl

Unless required by applicable law or agreed to in writing, software distributed
under the Licence is distributed on an "AS IS" basis, WITHOUT WARRANTIES OR
CONDITIONS OF ANY KIND, either express or implied. See the Licence for the
specific language governing permissions and limitations under the Licence.
-->
<UserControl x:Class="TecWare.PPSn.Controls.PpsMasterDataSelector"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:TecWare.PPSn.Controls"
      mc:Ignorable="d" 
      d:DesignHeight="300" d:DesignWidth="300">
	<UserControl.Resources>
		<local:MasterDataConstantConverter x:Key="masterDataConstantConverter" />
	</UserControl.Resources>
	<Grid>
		<TextBox 
			x:Name="SelectedConstantTextbox" 
			GotFocus="SelectedConstantTextbox_GotFocus">
			<TextBox.Resources>
				<local:MasterDataConstantsConverter x:Key="masterDataConstantsConverter" />
			</TextBox.Resources>
			<TextBox.Text>
				<MultiBinding Converter="{StaticResource masterDataConstantsConverter}" Mode="OneWay">
					<Binding RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType=UserControl}" Path="DisplayMemberPath" Mode="OneWay"/>
					<Binding RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType=UserControl}" Path="SelectedValue" Mode="OneWay"/>
				</MultiBinding>
			</TextBox.Text>
		</TextBox>
		<Path 
			HorizontalAlignment="Right" 
			VerticalAlignment="Center" 
			Height="18" 
			Width="19" 
			Margin="0,2,5,2" 
			Stretch="Fill" 
			Fill="#FF000000" 
			Data="F1 M 22,46.9996C 26.4235,48.3026 34.4825,48.8053 37.2083,52.2153L 37.2083,32.9996C 34.4826,29.5896 26.4235,29.0869 22,27.7839L 22,46.9996 Z M 22,24.3078L 22,24.028C 26.4235,25.331 34.4825,25.8337 37.2083,29.2437L 38,29.4716L 38.7917,29.2157C 41.5174,25.8057 49.5765,25.303 54,24L 54,24.2798C 55.2286,24.6498 56,24.9716 56,24.9716L 56,27.9716L 59,26.8258L 59,50.9716C 59,50.9716 41.1667,52.2216 38,57.7633L 37.9999,57.7913C 34.8333,52.2496 17,50.9996 17,50.9996L 17,26.8538L 20,27.9996L 20,24.9996C 20,24.9996 20.7714,24.6778 22,24.3078 Z M 23.5,44.506L 23.5,41.3844C 27.269,42.243 32.4604,42.8187 35.5,44.7496L 35.5,47.8712C 32.4604,45.9402 27.269,45.3646 23.5,44.506 Z M 23.5,39.1212L 23.5,35.9996C 27.269,36.8582 32.4604,37.4338 35.5,39.3648L 35.5,42.4864C 32.4604,40.5554 27.269,39.9798 23.5,39.1212 Z M 23.5,33.6344L 23.5,30.5128C 27.269,31.3714 32.4604,31.947 35.5,33.878L 35.5,36.9996C 32.4604,35.0686 27.269,34.493 23.5,33.6344 Z M 54,46.9716L 54,27.7559C 49.5765,29.0589 41.5174,29.5616 38.7917,32.9716L 38.7917,52.1873C 41.5175,48.7773 49.5765,48.2746 54,46.9716 Z M 52.5,44.478C 48.731,45.3366 43.5395,45.9122 40.5,47.8432L 40.5,44.7216C 43.5395,42.7906 48.731,42.215 52.5,41.3564L 52.5,44.478 Z M 52.5,39.0932C 48.731,39.9518 43.5395,40.5274 40.5,42.4584L 40.5,39.3368C 43.5396,37.4058 48.731,36.8302 52.5,35.9716L 52.5,39.0932 Z M 52.5,33.6064C 48.731,34.465 43.5395,35.0406 40.5,36.9716L 40.5,33.85C 43.5395,31.919 48.731,31.3434 52.5,30.4848L 52.5,33.6064 Z "/>
		<Popup 
			Width="{Binding ElementName=SelectedConstantTextbox, Path=ActualWidth}" MaxHeight="300" x:Name="pop">
			<Popup.Resources>
				<local:OringMultiValueConverter x:Key="oringMultiValueConverter" />
			</Popup.Resources>
			<Popup.IsOpen>
				<MultiBinding Converter="{StaticResource oringMultiValueConverter}" Mode="OneWay">
					<Binding ElementName="SelectedConstantTextbox" Path="IsKeyboardFocused" Mode="OneWay"/>
					<Binding ElementName="SearchConstantTextbox" Path="IsKeyboardFocused" Mode="OneWay"/>
				</MultiBinding>
			</Popup.IsOpen>
			<Border BorderThickness="1" >
				<Grid  Background="{Binding ElementName=SearchConstantTextbox, Path=Background}">
					<Grid.RowDefinitions>
						<RowDefinition Height="20" />
						<RowDefinition />
					</Grid.RowDefinitions>
					<TextBox x:Name="SearchConstantTextbox" 
							 Grid.Row="0" 
							 Margin="20,0,0,0"
							 KeyUp="SearchConstantTextbox_KeyUp"
							 Text="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=UserControl}, Path=FilterText, Mode=OneWayToSource, UpdateSourceTrigger=PropertyChanged}">
					</TextBox>
					<Canvas Grid.Row="0">
						<Path 
							HorizontalAlignment="Left" 
							Grid.Row="0" 
							Margin="5,0,0,5" 
							Width="14" 
							Height="14" 
							Stretch="Fill" 
							Fill="#67000000" 
							Data="F1 M 57,19L 57,26L 50,26L 50,19L 57,19 Z M 48,19L 48,26L 41,26L 41,19L 48,19 Z M 39,19L 39,26L 32,26L 32,19L 39,19 Z M 57,28L 57,35L 50,35L 50,28L 57,28 Z M 48,28L 48,35L 41,35L 41,28L 48,28 Z M 39,28L 39,35L 32,35L 32,28L 39,28 Z M 57,37L 57,44L 50,44L 50,37L 57,37 Z M 48,37L 48,44L 41,44L 41,37L 48,37 Z M 39,37L 39,44L 32,44L 32,37L 39,37 Z "/>
						<Path 
							HorizontalAlignment="Left" 
							Grid.Row="0" 
							Width="18" 
							Height="18" 
							Stretch="Fill" 
							Fill="#FF000000" 
							Data="F1 M 23.6506,56.2021C 22.5867,57.266 20.8618,57.266 19.7979,56.2021C 18.734,55.1382 18.734,53.4133 19.7979,52.3494L 27.6722,44.4751C 26.6112,42.7338 26,40.6883 26,38.5C 26,32.1487 31.1487,27 37.5,27C 43.8513,27 49,32.1487 49,38.5C 49,44.8513 43.8513,50 37.5,50C 35.3117,50 33.2662,49.3888 31.5249,48.3278L 23.6506,56.2021 Z M 37.5,31C 33.3579,31 30,34.3579 30,38.5C 30,42.6421 33.3579,46 37.5,46C 41.6421,46 45,42.6421 45,38.5C 45,34.3579 41.6421,31 37.5,31 Z "/>
					</Canvas>
					<ListBox
						x:Name="ConstantsListbox"
						Grid.Row="1"
						HorizontalContentAlignment="Stretch" 
						ScrollViewer.HorizontalScrollBarVisibility="Hidden"
						ItemTemplate="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=UserControl}, Path=ListTemplateDev}"
						SelectedItem="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=UserControl}, Path=SelectedValue, Converter={StaticResource masterDataConstantConverter}}">
						<ListBox.Resources>
							<local:MasterDataConstantsConverter x:Key="masterDataConstantsConverter" />
						</ListBox.Resources>
						<!--<ListBox.ItemTemplate>
							<DataTemplate>
								<local:SearchHighlightTextBlock 
									Width="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=ListBox}, Path=ActualWidth}" 
									IsEnabled="False" 
									BaseText="{Binding Name}" 
									SearchText="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=UserControl}, Path=FilterText}"/>
							</DataTemplate>
						</ListBox.ItemTemplate>-->
						<ListBox.ItemsSource>
							<MultiBinding Converter="{StaticResource masterDataConstantsConverter}" Mode="OneWay">
								<Binding RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType=UserControl}" Path="ConstantsSource" Mode="OneWay"/>
								<Binding RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType=UserControl}" Path="DisplayMemberPath" Mode="OneWay"/>
								<Binding ElementName="SearchConstantTextbox" Path="Text" Mode="OneWay"/>
							</MultiBinding>
						</ListBox.ItemsSource>
					</ListBox>
				</Grid>
			</Border>
		</Popup>
	</Grid>
</UserControl>
